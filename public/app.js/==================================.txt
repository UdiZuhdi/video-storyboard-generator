// ============================================
// GENERATOR PAPAN CERITA AI - APP.JS
// ============================================

console.log("üé¨ Aplikasi Generator Papan Cerita AI dimuat!");

// Function untuk show alert
function showAlert(message, type = 'info') {
    // Create alert element
    const alert = document.createElement('div');
    alert.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 8px;
        background: ${type === 'success' ? '#10b981' : 
                    type === 'error' ? '#ef4444' : 
                    type === 'warning' ? '#f59e0b' : '#3b82f6'};
        color: white;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        z-index: 9999;
        animation: slideIn 0.3s ease;
    `;
    
    alert.innerHTML = `
        ${type === 'success' ? '‚úÖ' : 
          type === 'error' ? '‚ùå' : 
          type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}
        ${message}
        <button onclick="this.parentElement.remove()" style="
            background: none;
            border: none;
            color: white;
            margin-left: 15px;
            cursor: pointer;
        ">‚úï</button>
    `;
    
    document.body.appendChild(alert);
    
    // Auto remove after 5 seconds
    setTimeout(() => {
        if (alert.parentElement) alert.remove();
    }, 5000);
}

// Function untuk generate contoh storyboard
function generateStoryboard() {
    console.log("üöÄ Membuat papan cerita...");
    
    // Dapatkan input dari user
    const storyInput = document.getElementById('story-input').value;
    const genre = document.getElementById('genre-select').value;
    const sceneCount = document.getElementById('scene-count').value;
    
    if (!storyInput.trim()) {
        showAlert('‚ö†Ô∏è Sila masukkan idea cerita!', 'warning');
        return;
    }
    
    // Tunjukkan loading
    const btn = document.getElementById('generate-btn');
    const originalText = btn.innerHTML;
    btn.innerHTML = '‚è≥ Sedang menghasilkan...';
    btn.disabled = true;
    
    // Simulate AI processing
    setTimeout(() => {
        // Create storyboard container jika belum wujud
        let container = document.getElementById('storyboard-container');
        
        if (!container) {
            container = document.createElement('div');
            container.id = 'storyboard-container';
            container.className = 'storyboard-container';
            document.querySelector('.storyboard-section').appendChild(container);
        }
        
        // Generate contoh scenes
        const scenesHTML = `
            <div class="storyboard-header">
                <h3>üìñ Cerita Anda</h3>
                <p>${storyInput.substring(0, 100)}...</p>
            </div>
            <div class="scenes-grid">
                ${Array.from({length: sceneCount}, (_, i) => i + 1).map(num => `
                <div class="scene-card">
                    <div class="scene-number">${num}</div>
                    <h4>Adegan ${num}</h4>
                    <p>Ini adalah adegan ke-${num} dari cerita anda.</p>
                    <div class="scene-image">üñºÔ∏è Imej ${num}</div>
                    <small>Genre: ${genre} | Masa: 1:00</small>
                </div>
                `).join('')}
            </div>
        `;
        
        container.innerHTML = scenesHTML;
        
        // Tunjukkan export buttons
        document.getElementById('export-controls').style.display = 'flex';
        
        // Reset button
        btn.innerHTML = originalText;
        btn.disabled = false;
        
        showAlert('‚úÖ Papan cerita berjaya dihasilkan!', 'success');
        console.log("Papan cerita siap!");
        
    }, 2000); // 2 second delay untuk simulation
}

// Function untuk setup scene slider
function setupSceneSlider() {
    const slider = document.getElementById('scene-count');
    const display = document.getElementById('scene-count-display');
    
    if (slider && display) {
        slider.addEventListener('input', function() {
            display.textContent = this.value;
        });
    }
}

// Function untuk setup semua event listeners
function setupEventListeners() {
    console.log("üéÆ Setting up event listeners...");
    
    // 1. Generate Button
    const generateBtn = document.getElementById('generate-btn');
    if (generateBtn) {
        generateBtn.addEventListener('click', generateStoryboard);
        console.log("‚úÖ Generate button siap");
    }
    
    // 2. Scene Slider
    setupSceneSlider();
    
    // 3. Export Buttons
    const exportButtons = ['export-html', 'export-pdf', 'export-png', 'save-project'];
    exportButtons.forEach(id => {
        const btn = document.getElementById(id);
        if (btn) {
            btn.addEventListener('click', function() {
                showAlert(`Fungsi ${id.replace('export-', '')} dalam pembangunan`, 'info');
            });
        }
    });
    
    // 4. Pre-fill contoh
    const storyInput = document.getElementById('story-input');
    if (storyInput && !storyInput.value) {
        storyInput.value = "Seorang pahlawan muda mencari harta karun di pulau misteri.";
    }
}

// Initialize app apabila DOM siap
document.addEventListener('DOMContentLoaded', function() {
    console.log("‚úÖ DOM sedia!");
    
    // Check semua element penting
    const requiredElements = ['generate-btn', 'story-input', 'genre-select', 'scene-count'];
    const missingElements = requiredElements.filter(id => !document.getElementById(id));
    
    if (missingElements.length > 0) {
        console.error("‚ùå Element hilang:", missingElements);
        showAlert(`Element tidak ditemui: ${missingElements.join(', ')}`, 'error');
    } else {
        console.log("‚úÖ Semua element ditemui");
        setupEventListeners();
    }
});

// Add CSS untuk scene cards
const style = document.createElement('style');
style.textContent = `
    .storyboard-container {
        background: #f8fafc;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
    }
    
    .storyboard-header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e2e8f0;
    }
    
    .scenes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
    }
    
    .scene-card {
        background: white;
        border-radius: 8px;
        padding: 15px;
        border: 1px solid #e2e8f0;
        transition: transform 0.2s;
    }
    
    .scene-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .scene-number {
        background: #4f46e5;
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .scene-image {
        background: #f1f5f9;
        height: 100px;
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 10px 0;
        color: #64748b;
        border: 2px dashed #cbd5e1;
    }
    
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
`;
document.head.appendChild(style);

console.log("üéâ App.js loaded successfully!");